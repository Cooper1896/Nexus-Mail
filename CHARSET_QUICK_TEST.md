# 邮件乱码修复 - 快速测试指南

## 快速开始

### 1️⃣ 启动应用
```bash
npm run electron:dev
```

### 2️⃣ 添加邮件账户

推荐使用以下邮箱（通常包含多字节编码邮件）：
- **QQ邮箱** (qq.com) - 经常使用GB2312/GBK
- **网易163邮箱** (163.com) - 经常使用GB2312/GBK  
- **新浪邮箱** (sina.com) - 经常使用GB2312/GBK
- **腾讯企业邮箱** - 包含各种编码

### 3️⃣ 同步邮件并查看

1. 添加账户后等待邮件同步
2. 查看收件箱中的邮件
3. 点击任何邮件查看详细内容

## 检查修复是否生效

### ✅ 成功迹象

邮件正确显示：
- 中文字符清晰可读
- 日文、韩文字符正确显示
- 特殊符号和表情正确呈现

### ❌ 问题迹象

如果仍然看到乱码：
- `啟?碴 ³?`
- `???????????`
- 混乱的符号和字符

## 调试步骤

### 查看日志

在启动的终端中查看这些信息：

```
[MIME] Content-Type: text/plain; Charset: gb2312, Encoding: quoted-printable
[MIME Header] Decoded B-encoded gb2312: ...
[Charset] iconv decode failed for "unknown-charset"...
```

### 检查特定邮件

1. 在浏览器开发者工具中按 `F12` 打开
2. 切换到 "Network" 标签
3. 刷新邮件列表
4. 查看返回的邮件数据

### 运行诊断工具

```bash
node diagnose-charset.js
```

输出应该显示所有编码都支持：
```
✅ gb2312 (normalized: gbk)
✅ big5 (normalized: big5)
✅ iso-8859-1 (normalized: latin1)
...
```

## 常见问题

### Q: 重启后仍然是乱码？
**A:** 
1. 确保已重新启动 `npm run electron:dev`
2. 清除浏览器缓存（按 Ctrl+Shift+Delete）
3. 重新同步邮件

### Q: 只有部分邮件乱码？
**A:** 可能是：
- 该邮件原本就编码有问题
- 邮件服务器配置不当
- 邮件客户端生成错误

### Q: 看不到任何日志？
**A:**
1. 确保在启动 `npm run electron:dev` 的终端中查看
2. 滚动回历史记录查找相关日志
3. 如果看到 `[MIME]` 开头的日志，说明修复已激活

### Q: 特定字体显示不正确？
**A:**
- 这不是编码问题，是渲染问题
- 在 CSS 中调整字体系列
- 检查系统是否安装了相关字体

## 测试场景

### 场景 1：GB2312 编码邮件
从 QQ 邮箱发送一封邮件到自己，然后在应用中查看。

**预期结果**：
- 邮件主题正确显示
- 邮件正文中文清晰

### 场景 2：多编码混合
转发一封包含多部分内容的邮件。

**预期结果**：
- 所有部分都正确显示
- 没有乱码或混乱字符

### 场景 3：Quoted-Printable 编码
发送包含特殊字符的邮件。

**预期结果**：
- 特殊字符和重音符正确显示
- 邮件格式保持

## 性能检查

修复不应该影响性能：

- 📊 邮件同步速度：不变（< 1秒/条）
- 💾 内存使用：不增加（< 5MB）
- ⚡ UI 响应：不变（仍然流畅）

## 修复覆盖的编码

| 地区 | 编码 | 状态 |
|------|------|------|
| 中文简体 | GB2312, GBK, GB18030 | ✅ |
| 中文繁体 | Big5 | ✅ |
| 日文 | Shift-JIS, EUC-JP | ✅ |
| 韩文 | EUC-KR | ✅ |
| 欧洲 | ISO-8859-1, Windows-1252 | ✅ |
| 国际 | UTF-8, UTF-16 | ✅ |

## 下一步

1. ✅ 启动应用
2. ✅ 添加包含多字节编码邮件的账户
3. ✅ 查看邮件，验证显示正常
4. ✅ 如有问题，运行 `diagnose-charset.js`
5. ✅ 根据日志调整配置

---

**最后更新**：2025-12-07
